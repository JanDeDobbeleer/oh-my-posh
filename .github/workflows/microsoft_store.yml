name: Submit Oh My Posh to the Windows Store

on:
  workflow_dispatch:
    branches:
      - main
  schedule:
    - cron: '0 0 * * 6' # At 00:00 on Saturday.

jobs:
  microsoft_store:
    name: Publish Microsoft Store
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code ðŸ‘‹
        uses: actions/checkout@v3
      - name: Get version
        id: version
        run: >-
          echo "::set-output name=VERSION::$(
            git describe --tags --abbrev=0 |
            cut -c2-
          )"
      - name: Configure Store Credentials ðŸ”‘
        uses: microsoft/store-submission@v1
        with:
          command: configure
          type: win32
          seller-id: ${{ secrets.SELLER_ID }}
          product-id: ${{ secrets.PRODUCT_ID }}
          tenant-id: ${{ secrets.TENANT_ID }}
          client-id: ${{ secrets.CLIENT_ID }}
          client-secret: ${{ secrets.CLIENT_SECRET }}
      - name: Update draft submission
        uses: microsoft/store-submission@v1
        with:
          command: update
          product-update: '{
              "packages":[
                  {
                    "packageUrl":"https://github.com/JanDeDobbeleer/oh-my-posh/releases/download/v${{ steps.version.outputs.VERSION }}/install-amd64.exe",
                    "languages":["en"],
                    "architectures":["X64"],
                    "installerParameters":"/VERYSILENT",
                    "isSilentInstall":true
                  }
              ]
            }'
      - name: Publish Submission
        uses: microsoft/store-submission@v1
        with:
          command: publish
