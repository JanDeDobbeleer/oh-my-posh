name: Windows Store
on:
  release:
    types: [published]

jobs:
  microsoft_store:
    name: Publish To Windows Store
    runs-on: ubuntu-latest
    steps:
      - name: Configure Store Credentials ðŸ”‘
        uses: jandedobbeleer/store-submission@submission-status
        with:
          command: configure
          type: win32
          seller-id: ${{ secrets.SELLER_ID }}
          product-id: ${{ secrets.PRODUCT_ID }}
          tenant-id: ${{ secrets.TENANT_ID }}
          client-id: ${{ secrets.CLIENT_ID }}
          client-secret: ${{ secrets.CLIENT_SECRET }}
          only-on-ready: true
      - name: Update draft submission
        uses: jandedobbeleer/store-submission@submission-status
        with:
          command: update
          product-update: '{
            "packages":[
                {
                  "packageUrl":"https://cdn.ohmyposh.dev/releases/${{ github.event.release.tag_name }}/install-x64.msix",
                  "languages":["en"],
                  "architectures":["X64"],
                  "isSilentInstall":true
                },
                {
                  "packageUrl":"https://cdn.ohmyposh.dev/releases/${{ github.event.release.tag_name }}/install-arm64.msix",
                  "languages":["en"],
                  "architectures":["Arm64"],
                  "isSilentInstall":true
                }
              ]
            }'
      - name: Publish Submission
        uses: jandedobbeleer/store-submission@submission-status
        with:
          command: publish
